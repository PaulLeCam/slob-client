<!DOCTYPE html><html lang="en"><head><title>core/dev</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="core/dev"><meta name="groc-project-path" content="src/core/dev.coffee"><meta name="groc-github-url" content="https://github.com/PaulLeCam/slob-client"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/PaulLeCam/slob-client/blob/master/src/core/dev.coffee">src/core/dev.coffee</a></div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h1 id="dev">dev</h1>

<h3 id="wrapper-for-the-console-to-ensure-logs-are-only-displayed-when-enabled">Wrapper for the console to ensure logs are only displayed when enabled.</h3></div></div><div class="code"><div class="wrapper"><span class="nx">define</span> <span class="p">[</span>
  <span class="s">&quot;./util&quot;</span>
<span class="p">],</span> <span class="nf">(util) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Get current time with best precision available</p></div></div><div class="code"><div class="wrapper">  <span class="nv">now = </span><span class="nx">performance</span><span class="o">?</span><span class="p">.</span><span class="nx">now</span> <span class="o">?</span> <span class="nx">performance</span><span class="o">?</span><span class="p">.</span><span class="nx">webkitNow</span> <span class="o">?</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Empty replacement functions for console if they are not available</p></div></div><div class="code"><div class="wrapper">  <span class="nv">csl = </span><span class="nx">console</span> <span class="o">?</span>
    <span class="nv">log: </span><span class="nf">-&gt;</span>
    <span class="nv">info: </span><span class="nf">-&gt;</span>
    <span class="nv">warn: </span><span class="nf">-&gt;</span>
    <span class="nv">error: </span><span class="nf">-&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Simple replacement functions for <code>time()</code> and <code>timeEnd()</code> if they are not available in the console</p></div></div><div class="code"><div class="wrapper">  <span class="nv">refs = </span><span class="p">{}</span>

  <span class="nx">csl</span><span class="p">.</span><span class="nx">time</span> <span class="o">?=</span> <span class="nf">(key) -&gt;</span>
    <span class="nx">refs</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">now</span><span class="p">()</span>

  <span class="nx">csl</span><span class="p">.</span><span class="nx">timeEnd</span> <span class="o">?=</span> <span class="nf">(key) -&gt;</span>
    <span class="k">if</span> <span class="nv">start = </span><span class="nx">refs</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
      <span class="nv">time = </span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span>
      <span class="nx">@log</span> <span class="s">&quot;`</span><span class="si">#{</span> <span class="nx">key</span> <span class="si">}</span><span class="s">`: </span><span class="si">#{</span> <span class="nx">time</span> <span class="si">}</span><span class="s">ms&quot;</span>
      <span class="k">delete</span> <span class="nx">refs</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>

  <span class="nv">api =</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>By default, logging is disabled, we have to explicitely enable it in the application</p></div></div><div class="code"><div class="wrapper">    <span class="nv">active: </span><span class="kc">no</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Decorate console functions to ensure they are only executed when logging is enabled</p></div></div><div class="code"><div class="wrapper">  <span class="nx">util</span><span class="p">.</span><span class="nx">each</span> <span class="p">[</span><span class="s">&quot;log&quot;</span><span class="p">,</span> <span class="s">&quot;info&quot;</span><span class="p">,</span> <span class="s">&quot;warn&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span><span class="p">,</span> <span class="s">&quot;time&quot;</span><span class="p">,</span> <span class="s">&quot;timeEnd&quot;</span><span class="p">],</span> <span class="nf">(func) -&gt;</span>
    <span class="nx">api</span><span class="p">[</span><span class="nx">func</span><span class="p">]</span> <span class="o">=</span> <span class="nf">-&gt;</span>
      <span class="k">if</span> <span class="nx">@active</span> <span class="k">then</span> <span class="nx">csl</span><span class="p">[</span><span class="nx">func</span><span class="p">].</span><span class="nx">apply</span> <span class="nx">csl</span><span class="p">,</span> <span class="nx">arguments</span>
      <span class="nx">@</span>

  <span class="nx">api</span></div></div></div></div></body></html>